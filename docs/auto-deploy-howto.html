<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>How to Automatically Deploy mdbook to GitHub Pages - Nate&#x27;s Page</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="hello-world.html"><strong aria-hidden="true">1.</strong> Hello, World!</a></li><li class="chapter-item expanded "><a href="auto-deploy-howto.html" class="active"><strong aria-hidden="true">2.</strong> How to Automatically Deploy mdbook to GitHub Pages</a></li><li class="chapter-item expanded "><a href="removing-rust-boilerplate.html"><strong aria-hidden="true">3.</strong> Removing Rust Boilerplate</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Nate&#x27;s Page</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="site-mechanics"><a class="header" href="#site-mechanics">Site Mechanics</a></h1>
<p>This <a href="https://github.com/nathan-at-least/nathan-at-least.github.io">site source</a> is an <a href="https://rust-lang.github.io/mdBook/">mdbook</a> instance, which is automatically deployed to <a href="https://pages.github.com/">GitHub Pages</a> when Pull-Requests are merged.</p>
<p>This page describes the implementation of this deployment. Let me know if you find this helpful, or if you have issues / questions / improvements, please use <a href="https://github.com/nathan-at-least/nathan-at-least.github.io/issues">this site's issue tracker</a>.</p>
<h2 id="design-goals"><a class="header" href="#design-goals">Design Goals</a></h2>
<ul>
<li>Rendered content (anything generated by a program) should not be in revision control, because it's not source code. Typically humans shouldn't care about changes to rendered content unless they are diagnosing automation problems. By contrast, humans should definitely care about source, especially for a book.</li>
<li>The book is automatically rendered to the public site whenever a PR is merged.</li>
<li>The &quot;rendering branch&quot; <code>gh-pages</code> tracks all rendered revisions in its history, while also linking to each render source revision (as a merge).</li>
</ul>
<h2 id="components"><a class="header" href="#components">Components</a></h2>
<p>To achieve these goals, we have several components:</p>
<ul>
<li>We use a special purpose <code>gh-pages</code> branch that <em>does</em> contain rendered output. This should be the only exception. Other branches can have human-meaningful source.</li>
<li><code>mdbook</code> must be configured to render into <code>./docs</code> as a requirement of GitHub Pages: <a href="https://github.com/nathan-at-least/nathan-at-least.github.io/blob/8e77b8babaf681fa67cd08575a3b0d9dc8e85532/book.toml#L8-L10">book.toml</a></li>
<li>We <code>.gitignore</code> the <code>docs/</code> dir, since this is rendered output, not human-meaningful source: <a href="https://github.com/nathan-at-least/nathan-at-least.github.io/blob/8e77b8babaf681fa67cd08575a3b0d9dc8e85532/.gitignore#L1">.gitignore</a></li>
<li>We add a <code>deploy.toml</code> GitHub Action which will deploy whenever we merge a PR to <code>main</code> branch: <a href="https://github.com/nathan-at-least/nathan-at-least.github.io/blob/1919e38c0eced2a2352ec09b03cf9a4ff7f2d12e/.github/workflows/deploy.yaml">.github/workflows/deploy.yaml</a></li>
<li>We configure the GitHub repository to enable GitHub Page hosting.</li>
</ul>
<h2 id="setting-it-up"><a class="header" href="#setting-it-up">Setting It Up</a></h2>
<h3 id="create-and-mdbook"><a class="header" href="#create-and-mdbook">Create and <code>mdbook</code></a></h3>
<p>See the <a href="https://rust-lang.github.io/mdBook/guide/creating.html">mdbook guide</a> to get started.</p>
<h3 id="configure-mdbook-and-gitignore"><a class="header" href="#configure-mdbook-and-gitignore">Configure <code>mdbook</code> and <code>.gitignore</code></a></h3>
<p>First we need to configure to render to <code>./docs</code> by adding this to <a href="https://github.com/nathan-at-least/nathan-at-least.github.io/blob/8e77b8babaf681fa67cd08575a3b0d9dc8e85532/book.toml#L8-L10">book.toml</a>:</p>
<pre><code>[build]
# Follow gh pages convention:
build-dir = &quot;./docs&quot;
</code></pre>
<p>-and let's also ignore the render dir, because of our first design goal by adding this to <a href="https://github.com/nathan-at-least/nathan-at-least.github.io/blob/8e77b8babaf681fa67cd08575a3b0d9dc8e85532/.gitignore#L1">.gitignore</a>:</p>
<pre><code>docs/
</code></pre>
<h3 id="add-the-deployyaml-github-action"><a class="header" href="#add-the-deployyaml-github-action">Add the <code>deploy.yaml</code> GitHub Action</a></h3>
<p>The <a href="https://github.com/nathan-at-least/nathan-at-least.github.io/blob/1919e38c0eced2a2352ec09b03cf9a4ff7f2d12e/.github/workflows/deploy.yaml">.github/workflows/deploy.yaml</a> does all the good stuff. It:</p>
<ul>
<li>triggers on any push to <code>main</code> (the default repo branch),</li>
<li>installs <code>mdbook</code>,</li>
<li>checks out the source,</li>
<li>creates a new merge commit on <code>gh-pages</code> that overwrites the previous content with the new revision on <code>main</code>,</li>
<li>renders the source with <code>mdbook</code>,</li>
<li>removes <code>./docs</code> from <code>.gitignore</code> since this is the one exception to committing rendered content,</li>
<li>disables <code>jekyll</code> (the standard GitHub Pages rendering system),</li>
<li>and finally, commits and pushes the rendered content to the <code>gh-pages</code> branch.</li>
</ul>
<p>This should result in two commits onto <code>gh-pages</code> per render cycle: one is a merge that overwrites the previous contents of <code>gh-pages</code> with the new <code>main</code> content, and the second includes the rendering output. This design enables seeing the deployment history on the <code>gh-pages</code> which is tracked interleaved merge/render commits. Each merge additionally points to the revision of <code>main</code> where the content comes from, overwriting any previous changes on the <code>gh-pages</code> branch.</p>
<h3 id="configuring-github-pages"><a class="header" href="#configuring-github-pages">Configuring GitHub Pages</a></h3>
<p>The final step is to tell GitHub Pages where to find the rendered site content:</p>
<ul>
<li>repo -&gt; &quot;Settings&quot; -&gt; &quot;Pages&quot;</li>
<li>Set source to <code>gh-pages</code> branch. You may need to create this branch first; one way is by merging a PR to <code>main</code> to trigger the deploy action to produce your first render.</li>
<li>Set the path to <code>docs/</code>.</li>
</ul>
<h3 id="writing-cycle"><a class="header" href="#writing-cycle">Writing Cycle</a></h3>
<p>Because this rendering only occurs when you merge to <code>main</code>, it should only be used for &quot;finished&quot; updates you want to publish to the world. Make sure to render and review your edits as you go prior to merging a PR.</p>
<p>On linux I use this command to quickly view the rendered version:</p>
<pre><code>$ mdbook build &amp;&amp; xdg-open ./docs/index.html
</code></pre>
<p>This works better for me than the <code>mdbook</code> built-in reloading webserver; do whatever works best for you.</p>
<h3 id="fin"><a class="header" href="#fin">Fin.</a></h3>
<p>Now you can edit the source of your site in a clean manner without the clutter of renderings. Enjoy!</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="hello-world.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="removing-rust-boilerplate.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="hello-world.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="removing-rust-boilerplate.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
